<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.prime.com.tr/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets" template="/template/template.xhtml">

    <ui:define name="title">图书查询(lazy)</ui:define>

    <ui:define name="content">
        <f:metadata>
			<f:viewParam name="id" value="#{bookBean.id}" />
			<f:event type="preRenderView" listener="#{bookBean.initConversation}" />
		</f:metadata>

        <h:form id="bookForm" prependId="false">

            <p:panel styleClass="panel1">

                <f:facet name="header">
                    <img src="#{facesContext.externalContext.requestContextPath}/images/icons/tabTitle.gif" alt=""/>
                    <h:outputLabel value="图书查询    |    "/>
                    <h:outputLink value="#{facesContext.externalContext.requestContextPath}/faces/book/input.xhtml">
                        <h:outputText value="添加图书"/>
                    </h:outputLink>
                </f:facet>

                <p:fieldset>
                    <h:panelGrid columns="4">
                        <h:outputLabel value="书名："/>
                        <input type="text" id="filter_LIKES_name" name="filter_LIKES_name"
                               class="input_160" value="#{param['filter_LIKES_name']}"/>

                        <p:commandButton action="#{bookBean.search}"
                                         ajax="false" value="查询" image="ui-icon ui-icon-search"/>
                    </h:panelGrid>
                </p:fieldset>

                <br/>

                <p:dataTable var="book" value="#{bookBean.lazyModel}" paginator="true" rows="2" lazy="true"
                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                             rowsPerPageTemplate="2,10,15"
                             selectionMode="single" onRowSelectUpdate="display">

                    <f:facet name="header">图书列表</f:facet>

                    <p:column headerText="书名">
                        <h:outputText value="#{book.name}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="作者"/>
                        </f:facet>
                        <h:outputText value="#{book.author}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="页数"/>
                        </f:facet>
                        <h:outputText value="#{book.pageNum}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="价格"/>
                        </f:facet>
                        <h:outputText value="#{book.price}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="出版日期"/>
                        </f:facet>
                        <h:outputText value="#{book.pubDate}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="是否有货"/>
                        </f:facet>
                        <h:outputText value="#{book.available}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="类别"/>
                        </f:facet>
                        <h:outputText value="#{book.catagory}"/>
                    </p:column>

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="详细描述"/>
                        </f:facet>
                        <h:outputText value="#{book.description}"/>
                    </p:column>

                    <p:column style="width:80px;text-align:center;">
                        <f:facet name="header">
                            <h:outputText value="操作"/>
                        </f:facet>

                        <p:commandLink update=":bookForm:display" action="#{bookBean.view}"
                                       oncomplete="bookDialog.show()" value="查看" ajax="false">
                            <f:setPropertyActionListener value="#{book}" target="#{bookBean.instance}"/>
                        </p:commandLink>

                        <p:commandLink update=":bookForm:display" oncomplete="bookDialog.show()" value="修改">
                            <f:setPropertyActionListener value="#{book}" target="#{bookBean.instance}"/>
                        </p:commandLink>

                        <p:commandLink update=":bookForm:display" oncomplete="confirmation.show()" value="删除">
                            <f:setPropertyActionListener value="#{book}" target="#{bookBean.instance}"/>
                        </p:commandLink>

                    </p:column>

                </p:dataTable>

                <p:dialog header="修改Book" widgetVar="bookDialog" resizable="false" id="bookDlg"
                          width="600" showEffect="fade" hideEffect="explode" modal="true">
                    <h:panelGrid id="display" columns="2" cellpadding="5" cellspacing="1" styleClass="style1"
                                 rowClasses="row1,row2" columnClasses="column1,column2" footerClass="footer1">

                        <ui:include src="input-item.xhtml"/>

                        <f:facet name="footer">
                            <p:commandButton id="btn_book_Save" action="#{bookBean.save}" value="保存" update="bookTable"
                                             image="ui-icon ui-icon-disk" ajax="false" title="保存"/>

                            <p:commandButton value="取消" onclick="bookDialog.hide()" image="ui-icon ui-icon-cancel"
                                             title="取消"/>
                        </f:facet>

                    </h:panelGrid>

                </p:dialog>

                <p:confirmDialog message="是否删除此用户" hideEffect="explode"
                                 header="信息确认" severity="alert" widgetVar="confirmation">
                    <p:commandButton update=":bookForm:bookTable" value="确定" oncomplete="confirmation.hide()"
                                     actionListener="#{bookBean.delete}"/>
                    <p:commandButton value="取消" onclick="confirmation.hide()" type="button"/>
                </p:confirmDialog>
            </p:panel>
        </h:form>

    </ui:define>

</ui:composition>

