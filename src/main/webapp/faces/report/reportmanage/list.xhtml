<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/template/template.xhtml">

	<ui:define name="title">报表查询</ui:define>

	<ui:define name="content">
		<p:panel styleClass="panel1">
			<f:facet name="header">
				<img src="#{request.contextPath}/images/icons/tabTitle.gif" alt="" />
				<h:outputLabel value="报表查询    |    " />
				<h:outputLink
					value="#{request.contextPath}/faces/report/reportmanage/input.xhtml">
					<h:outputText value="添加报表" />
				</h:outputLink>
			</f:facet>

			<h:form id="reportForm" prependId="false">
				<p:fieldset>
					<h:panelGrid columns="4">
						报表编号：<p:inputText
							value="#{reportManageBean.filterMap['LIKES_reportCode']}" />
						报表名称：<p:inputText
							value="#{reportManageBean.filterMap['LIKES_reportName']}" />
						报表模式：<h:selectOneMenu
							value="#{reportManageBean.filterMap['EQS_reportMode']}">
							<f:selectItem itemLabel="--请选择--" itemValue="" />
							<f:selectItems value="#{reportManageBean.reportModeList}" />
						</h:selectOneMenu>
        				报表分类：<h:selectOneMenu
							value="#{reportManageBean.filterMap['EQS_reportCategory']}">
							<f:selectItem itemLabel="--请选择--" itemValue="" />
							<f:selectItems value="#{reportManageBean.reportCategoryList}" />
						</h:selectOneMenu>
						<p:commandButton id="btn_report_search"
							actionListener="#{reportManageBean.search}"
							update="reportDataPanel" value="查询"
							image="ui-icon ui-icon-search" />
					</h:panelGrid>
				</p:fieldset>
				<br />

				<h:panelGroup id="reportDataPanel">
					<p:dataTable id="reportDataTable" var="reportMstr"
						value="#{reportManageBean.lazyModel}" paginator="true" rows="10"
						lazy="true" paginatorPosition="bottom"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
						selectionMode="single" rowKey="#{reportMstr.id}">

						<p:ajax event="rowSelect"
							listener="#{reportManageBean.onRowSelect}" update="reportManager,reportManageTab,tab1" oncomplete="tabManager.select(0)"/>
						<f:facet name="header">报表列表</f:facet>

						<p:column headerText="报表分类">
							<h:outputText value="#{reportMstr.reportCategory}" />
						</p:column>

						<p:column headerText="报表编号">
							<h:outputText value="#{reportMstr.reportCode}" />
						</p:column>

						<p:column headerText="报表名称">
							<h:outputText value="#{reportMstr.reportName}" />
						</p:column>

						<p:column headerText="报表模式">
							<h:outputText value="#{reportMstr.reportMode}" />
						</p:column>

						<p:column headerText="备注">
							<h:outputText value="#{reportMstr.remarks}" />
						</p:column>

						<p:column headerText="操作" style="width:150px; text-align:center;">
							<p:commandButton
								update=":dialogForm:reportInput, :dialogForm:msg"
								oncomplete="reportDialog.show()" image="ui-icon ui-icon-search"
								title="查看">
								<f:param name="readOnly" value="true" />
								<f:setPropertyActionListener value="#{reportMstr}"
									target="#{reportManageBean.instance}" />
							</p:commandButton>

							<p:commandButton
								update=":dialogForm:reportInput, :dialogForm:msg"
								oncomplete="reportDialog.show()" image="ui-icon ui-icon-pencil"
								title="修改">
								<f:param name="readOnly" value="false" />
								<f:setPropertyActionListener value="#{reportMstr}"
									target="#{reportManageBean.instance}" />
							</p:commandButton>

							<p:commandButton
								update=":dialogForm:reportInput, :dialogForm:msg"
								oncomplete="confirmation.show()" image="ui-icon ui-icon-close"
								title="删除">
								<f:setPropertyActionListener value="#{reportMstr}"
									target="#{reportManageBean.instance}" />
							</p:commandButton>

							<p:commandButton image="ui-icon ui-icon-arrowreturnthick-1-n"
								update="rptFileForm" title="上传模板"
								action="#{reportFileBean.befforeAdd}"
								oncomplete="uploadAddDialog.show();">
								<f:setPropertyActionListener value="#{reportMstr.id}"
									target="#{reportFileBean.mastrId}" />

							</p:commandButton>

							<p:commandButton update="reportParameterForm"
								action="#{reportParameterBean.findReportParameterList}"
								oncomplete="reportParameterDialog.show()"
								image="ui-icon ui-icon-wrench" title="参数管理">
								<f:setPropertyActionListener value="#{reportMstr}"
									target="#{reportParameterBean.instance.reportMstr}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:panelGroup>
			</h:form>

			<br />
			<h:form id="reportManager" prependId="false">
			    
				<p:tabView dynamic="true" cache="false" id="reportManageTab"  widgetVar="tabManager">
					<p:ajax event="tabChange" listener="#{reportFileBean.onTabChange}" update="tabl2"/>
					<f:param name="masId" value="#{requestScope.rowSelect}"/>
					<p:tab title="报表参数" id="tabl1">
						<ui:include src="parameter-tab.xhtml" />
					</p:tab>
					<p:tab title="报表文件" id="tabl2" >
						<p:toolbar id="rptFilepanelBar">
							<p:toolbarGroup align="right">
								<p:commandButton value="上传模板" image="ui-icon ui-icon-plus"
									id="addRptPanel" oncomplete="uploadAddDialog.show();" />
							</p:toolbarGroup>
						</p:toolbar>
						<ui:include src="../reportfile/inc-list.xhtml" />
					</p:tab>
				</p:tabView>
			</h:form>

			<h:form prependId="false" id="rptFileForm"
				enctype="multipart/form-data">
				<ui:include src="../reportfile/inc-input.xhtml" />
			</h:form>

			<h:form id="dialogForm" prependId="false">
				<p:dialog header="报表信息" widgetVar="reportDialog" id="reportDlg"
					resizable="false" width="550" modal="true">
					<p:messages id="msg" />
					<h:panelGrid id="reportInput" columns="2" cellpadding="5"
						cellspacing="1" styleClass="style1" rowClasses="row1,row2"
						columnClasses="column1,column2" footerClass="footer1">

						<ui:include src="input-item.xhtml" />

						<f:facet name="footer">
							<p:commandButton id="btn_report_save"
								actionListener="#{reportManageBean.saveReportInfo}" value="保存"
								update="reportDataPanel, msg" rendered="#{!param.readOnly}"
								oncomplete="handleComplete(reportDialog,args);"
								image="ui-icon ui-icon-disk" />
							<p:commandButton value="#{param.readOnly ? '关闭' : '取消'}"
								onclick="reportDialog.hide()" image="ui-icon ui-icon-cancel" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>

				<p:dialog header="角色配置" widgetVar="reportRoleDialog"
					id="reportRoleDlg" resizable="false" width="550" modal="true">
					<p:pickList value="#{reportManageBean.dualModel}" var="role"
						itemLabel="#{role.roleName}" itemValue="#{role.id}" />
					<f:facet name="footer">
						<p:commandButton id="btn_report_role_config"
							actionListener="#{reportManageBean.roleConfig}"
							update="report_roles" oncomplete="reportRoleDialog.hide()"
							value="确定" image="ui-icon ui-icon-disk" />
						<p:commandButton value="取消" onclick="reportRoleDialog.hide()"
							image="ui-icon ui-icon-cancel" />
					</f:facet>
				</p:dialog>

				<p:confirmDialog header="信息确认" message="是否删除此报表" severity="alert"
					widgetVar="confirmation">
					<p:commandButton update="reportDataPanel" value="确定"
						oncomplete="confirmation.hide()"
						actionListener="#{reportManageBean.delete}" />
					<p:commandButton value="取消" onclick="confirmation.hide()"
						image="ui-icon ui-icon-cancel" />
				</p:confirmDialog>
			</h:form>
			<ui:include src="report-parameter.xhtml" />
		</p:panel>
	</ui:define>
</ui:composition>

